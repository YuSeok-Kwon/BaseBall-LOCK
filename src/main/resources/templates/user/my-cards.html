<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/reviewDefault}">
<head>
    <title>ë‚´ ë³´ìœ  ì¹´ë“œ</title>
</head>

<th:block layout:fragment="contents">
    <div class="container mt-4">
        <h2 class="mb-4">ë‚´ ë³´ìœ  ì¹´ë“œ</h2>
        <div class="row">
            <div class="d-flex justify-content-start mb-3">
			    <select id="gradeFilter" class="form-select me-2" style="width: 150px;">
			        <option value="">ì „ì²´ ë“±ê¸‰</option>
			        <option value="S">S ë“±ê¸‰</option>
			        <option value="A">A ë“±ê¸‰</option>
			        <option value="B">B ë“±ê¸‰</option>
			        <option value="C">C ë“±ê¸‰</option>
			    </select>
			    <select id="positionFilter" class="form-select" style="width: 150px;">
			        <option value="">ì „ì²´ í¬ì§€ì…˜</option>
			        <option value="P">íˆ¬ìˆ˜</option>
			        <option value="1B">1ë£¨ìˆ˜</option>
			        <option value="2B">2ë£¨ìˆ˜</option>
			        <option value="3B">3ë£¨ìˆ˜</option>
			        <option value="SS">ìœ ê²©ìˆ˜</option>
			        <option value="OF">ì™¸ì•¼ìˆ˜</option>
			        <option value="C">í¬ìˆ˜</option>
			        <option value="DH">ì§€ëª…íƒ€ì</option>
			    </select>
			</div>
			
			<!-- ì„ ìˆ˜ì¹´ë“œ -->
            <div class="col-md-3 mb-4"
			     th:each="card : ${cards}"
			     th:attr="data-grade=${card.grade}, data-position=${card.position}">
			    
			    <div class="pokemon-card card-flip"
			         th:classappend="' grade-' + ${card.grade}">
			        
			        <div class="card-inner">
			            <!-- ì¹´ë“œ ì•ë©´ -->
						<div class="card-front" th:classappend="' grade-' + ${card.grade}">
						
						    <!-- ìƒë‹¨ ë°°ë„ˆ: ì‹œì¦Œ / ë“±ê¸‰ -->
						    <div class="card-banner justify-content-between w-100">
						        <span class="season" th:text="${card.season} + ' ì‹œì¦Œ'"></span>
						        <span class="grade-label fw-bold" th:text="${card.grade} + ' ë“±ê¸‰'"></span>
						    </div>
						
						    <!-- Së“±ê¸‰ë§Œ ì´ë¯¸ì§€ í‘œì‹œ -->
						    <div class="card-image-wrapper" th:if="${card.grade == 'S'}">
						        <img th:src="@{/${card.imagePath}}"
						             th:alt="${card.playerName}"
						             class="card-image hologram">
						    </div>
						
						    <!-- ì„ ìˆ˜ ì •ë³´ -->
						    <div class="card-info text-center mt-3">
						        <h5 class="player-name my-2 fs-4" th:text="${card.playerName}"></h5>
						        <p class="position-team mb-1 d-flex align-items-center justify-content-center fs-5">
						            <span th:text="${card.position} + ' / '"></span>
						            <img th:src="@{'/static/emblems/' + ${card.teamLogo} + '.svg'}"
						                 th:alt="${card.teamName}"
						                 style="height: 30px; width: 30px; margin-right: 6px;">
						            <span th:text="${card.teamName}"></span>
						        </p>
						    </div>
						
						    <!-- ì£¼ìš” ìŠ¤íƒ¯ -->
						    <div class="card-stats text-center">
						        <p>WAR: <span th:text="${card.war}"></span></p>
						        <div th:if="${card.position == 'P'}">
						            <p>ERA: <span th:text="${card.era}"></span></p>
						            <p>WHIP: <span th:text="${card.whip}"></span></p>
						
						            <!-- ìŠ¹/ì„¸ì´ë¸Œ/í™€ë“œ ì¤‘ ìµœëŒ“ê°’ë§Œ ì¶œë ¥ -->
						            <th:block th:if="${card.wins >= card.saves and card.wins >= card.holds and card.wins > 0}">
						                <p><span th:text="${card.wins}"></span>ìŠ¹</p>
						            </th:block>
						            <th:block th:if="${card.saves > card.wins and card.saves >= card.holds and card.saves > 0}">
						                <p><span th:text="${card.saves}"></span>ì„¸ì´ë¸Œ</p>
						            </th:block>
						            <th:block th:if="${card.holds > card.wins and card.holds > card.saves and card.holds > 0}">
						                <p><span th:text="${card.holds}"></span>í™€ë“œ</p>
						            </th:block>
						        </div>
						
						        <div th:if="${card.position != 'P'}">
						            <p>AVG: <span th:text="${card.avg}"></span></p>
						            <p>OPS: <span th:text="${card.ops}"></span></p>
						
						            <th:block th:if="${card.hr >= card.sb and card.hr > 0}">
						                <p><span th:text="${card.hr}"></span>í™ˆëŸ°</p>
						            </th:block>
						            <th:block th:if="${card.sb > card.hr and card.sb > 0}">
						                <p><span th:text="${card.sb}"></span>ë„ë£¨</p>
						            </th:block>
						        </div>
						
						        <p class="mt-2 fw-bold fs-5">
						            ì¢…í•© ëŠ¥ë ¥ì¹˜: <span th:text="${card.overall}"></span>
						        </p>
						    </div>
						</div>
			
			            <!-- ë’·ë©´ -->
			            <div class="card-back" th:classappend="' grade-' + ${card.grade}">
			                <!-- ì‚­ì œ ë²„íŠ¼ -->
						    <button type="button"
						            class="delete-btn position-absolute top-0 end-0 m-2"
						            aria-label="Delete"
						            th:attr="data-player-id=${card.playerId}, data-season=${card.season}">
						            ğŸ—‘ï¸
						    </button>
			                <h6>ëŠ¥ë ¥ì¹˜ ìš”ì•½</h6>
			                <div th:if="${card.position == 'P'}">
			                    <p>ì»¨íŠ¸ë¡¤: <span th:text="${card.control}"></span></p>
			                    <p>êµ¬ìœ„: <span th:text="${card.stuff}"></span></p>
			                    <p>ì§€êµ¬ë ¥: <span th:text="${card.stamina}"></span></p>
			                    <p><strong>ì¢…í•©: <span th:text="${card.overall}"></span></strong></p>
			                </div>
			                <div th:if="${card.position != 'P'}">
			                    <p>íŒŒì›Œ: <span th:text="${card.power}"></span></p>
			                    <p>ì»¨íƒ: <span th:text="${card.contact}"></span></p>
			                    <p>ì„ êµ¬: <span th:text="${card.discipline}"></span></p>
			                    <p>ìŠ¤í”¼ë“œ: <span th:text="${card.speed}"></span></p>
			                    <p><strong>ì¢…í•©: <span th:text="${card.overall}"></span></strong></p>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
        </div>
	</div>
</th:block>
<th:block layout:fragment="script">
<script>
document.addEventListener('DOMContentLoaded', function () {
	
    const cards = document.querySelectorAll('.pokemon-card');

    for (let i = 0; i < cards.length; i++) {
        const card = cards[i];
        const inner = card.querySelector('.card-inner');

        card.addEventListener('mousemove', function (e) {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const rotateY = (x < rect.width / 2) ? 0 : 180;
            inner.style.transform = `rotateY(${rotateY}deg)`;
        });

        card.addEventListener('mouseleave', function () {
            inner.style.transform = 'rotateY(0deg)';
        });
    }
    
    // í•„í„° ì…€ë ‰íŠ¸ë°•ìŠ¤ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const gradeFilter = document.getElementById('gradeFilter');
    const positionFilter = document.getElementById('positionFilter');

    /*ì¹´ë“œ í•„í„°ë§ í•¨ìˆ˜*/
    function filterCards() {
        const selectedGrade = gradeFilter.value;
        const selectedPosition = positionFilter.value;

        const cardList = document.querySelectorAll('.col-md-3');

        for (let i = 0; i < cardList.length; i++) {
            const card = cardList[i];
            const cardGrade = card.getAttribute('data-grade');
            const cardPosition = card.getAttribute('data-position');

            // ì¡°ê±´ í™•ì¸
            let gradeMatch = selectedGrade === '' || cardGrade === selectedGrade;
            let positionMatch = selectedPosition === '' || cardPosition === selectedPosition;

            // ì¡°ê±´ ì¼ì¹˜ ì—¬ë¶€ì— ë”°ë¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            if (gradeMatch && positionMatch) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        }
    }
    
    // ì…€ë ‰íŠ¸ ë³€ê²½ ì‹œ í•„í„°ë§ ì‹¤í–‰
    gradeFilter.addEventListener('change', filterCards);
    positionFilter.addEventListener('change', filterCards);
    setupDeleteButtons();
});

function setupDeleteButtons() {
    const deleteButtons = document.querySelectorAll('.delete-btn');

    deleteButtons.forEach(btn => {
      btn.addEventListener('click', async function (e) {
        e.stopPropagation(); // ì¹´ë“œ ë’¤ì§‘í˜ ë°©ì§€

        const playerId = this.getAttribute('data-player-id');
        const season = this.getAttribute('data-season');

        if (!confirm('ì´ ì¹´ë“œë¥¼ ë°©ì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        
        const res = await fetch(`/game/card/delete?playerId=${playerId}&season=${season}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          const cardElement = this.closest('.col-md-3');
          if (cardElement) cardElement.remove();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨');
        }
      });
    });
  }
</script>
</th:block>